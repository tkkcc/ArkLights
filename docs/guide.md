# 必读

下载：[123pan](https://www.123pan.com/s/6MR9-5Fv7d) /
[蓝奏云(密码0000)](https://wwa.lanzoui.com/b010qimmf) /
[github release](https://github.com/tkkcc/ArkLights/releases)

闲聊群：[1009619697](https://qm.qq.com/cgi-bin/qm/qr?k=ZtJVQZ1LI_9nMh3tj7fKgYu5PrwqBCje&jump_from=webapi)

源码与其他明日方舟脚本：[github.com/tkkcc/ArkLights](https://github.com/tkkcc/ArkLights)
觉得好用请在github上给个star，这是对开发者最大的帮助。无法访问请看[国内主页](https://gitee.com/bilabila/arknights)。

## 最近更新

- 已root设备上会`重启acc进程`来保证脚本内存稳定，如多次出现无障碍启动失败、游戏启动失败、停止闪退等问题，可禁用。
<!-- - 默认不自动重启acc进程，但这样刷肉鸽每小时内存泄漏44M，一天1G。启用后会定期释放脚本内存，但在部分设备上会造成启动失败与闪退。 -->
<!-- - 单号最大剿灭次数默认为1。 -->
- 华云需手动运行指定命令，才有完整root权限。
<!-- - 5月19日前下载的用户需要重下apk，可覆盖安装，设置不丢 -->
<!-- - 幕后筹备抽空升级默认开启，高级设置中可关 -->
<!-- - 控制中枢与会客厅换班默认开启，高级设置中可关 -->
<!-- - 多账号跳过空账密默认开启，高级设置中可关 -->
<!-- - 自动用全权委托 -->
<!-- - 新增活动关SN-1~SN-10，1280x720分辨率可用关卡名，**其他分辨率只能用`上一次`** -->
<!-- - 新增CE-6、LS-6 -->
- magisk hide设备需**手动关闭root授权提示**

## 设备兼容

::: warning 前提条件
安卓版本>=7  
分辨率>=1280x720  
长宽比>=16:9
:::

#### 模拟器

支持 雷电4、逍遥（选OpenGL渲染）、蓝叠（选高级/高阶/兼容图形引擎）、genymotion(安卓10)、redroid(安卓10)、Android Emulator

不支持 雷电3、夜神、mumu6、mumu9（能用，但启动闪屏）

#### 云手机

支持 红手指（安卓6找客服升级）、雷电云、华云、合鑫云、双子星、云帅云

不支持 移动云

<!-- 注意： -->
<!-- 1. 从群友反馈看，红手指kvip、雷电云svip跑速通稳定性好。 -->
<!-- 1. 华云的root保活仍存在问题，但api较全。 -->


::: tip 华云需要执行以下命令使脚本获得完整root权限
```sh
adb connect 123.456.789.101:234
adb -s 123.456.789.101:234 shell "nohup sh -c 'nc -klp49876 -e sh' > /dev/null 2>&1 &"
```
其中123.456.789.101:234是adb地址，49876是预设端口不可更改。
每次重启手机后需要执行一次，执行后再运行脚本。
:::


#### 手机真机

支持 常见手机品牌

注意 游戏内异形屏适配设为0，系统关游戏模式，关游戏工具箱，关全局侧边栏，关深色夜间护眼模式，关隐藏刘海，虚拟键要位于右侧，边缘全面屏手势可能影响脚本点击。

部分已root真机可能需要勾选`禁用重启acc进程`。

如需小窗模式/后台运行/熄屏运行，请用手机虚拟机或云手机。

#### 手机虚拟机

支持 vmos、51、光速、x8。

## 基本使用

#### 直接弹出“停止运行”/“解析错误”

安卓版本低于7，或cpu架构不兼容（如M1芯片）

#### 怎么自动开无障碍

有root就会自动开无障碍。软件启动后的无障碍提示选“以后不再提醒”，进入后直接点“确定”。

#### 作战设置/账号密码/脚本设置不能修改无法输入/需要选择输入法

关闭懒人输入法。如已开启，卸载脚本后重装。

#### 输入框输入时或按快捷键时脚本闪退

用复制粘贴方法输入，或更换系统输入法与模拟器。

#### 一直在主界面与公告/邮箱/退出游戏切换

[手机注意事项](#手机真机)

#### 点了启动但没反应

[设备兼容](#设备兼容)

#### 怎么停止脚本/脚本无法关闭/点屏幕没反应/日志关不掉

法1. 按“音量+”

法2. 按home键，再按红色停止按钮

法3. 快速按红色停止按钮

#### 怎么关闭震动/关闭声音

软件右上角设置里关

#### 能不能不弹出日志框

不行。脚本框架问题。

#### 脚本怎么用

脚本主界面上方为“任务开始前的设置”，中间为“需要执行的任务”，下方为“任务完成后的设置”，底部为“更多功能”。

建议先不修改默认设置，直接点`启动并定时`。

#### 脚本需要游戏在什么界面时启动

几乎所有。

#### 怎么导入导出设置

设置以json格式保存在
```txt
/data/user/0/com.bilabila.arknightsspeedrun2/assistdir/3205c0ded576131ea255ad2bd38b0fb2/root/
```
可解析处理



多账号设置可导入导出。导入也支持如下简单格式(即`导出帐密`的格式)
```txt
username1 password1
username2 password2 B服
username3 password3 b
```
导入简单格式时会追加而非覆盖。但如果第30个账号已填，则从第1个账号开始覆盖。

#### 怎么一键重启脚本

悬浮按钮组中最上方那个

#### 突然没反应且悬浮按钮有绿边/出现“停止运行”、悬浮按钮消失、悬浮按钮位置改变

换设备

#### 突然没反应且悬浮按钮无绿边

脚本正常结束或出现代码bug

#### 模拟器屏幕颠倒/旋转/竖屏

雷电模拟器选“平板版”分辨率，取消“自动旋转屏幕”，选择“强制锁定横屏”。

#### 长时间挂机脚本闪退

<!-- ::: tip -->
<!-- 长时间挂机时，游戏与脚本占用内存会不断上涨(可用top监测到)，因此需要定期重启游戏与脚本进程来释放内存。在有root权限的情况下脚本才有能力做到这点。 -->
<!-- ::: -->

给root权限，单账号界面勾`完成之后关闭游戏`，多账号界面勾`切号前关闭其他服与当前服`(必要)。

<!-- 1. 模拟器使用`2核2G 1280x720`足够稳定挂机，闪退换模拟器/升级显卡驱动。 -->
<!---->
<!-- 1. 云手机闪退找客服换机，手机虚拟机闪退升级虚拟机软件，手机真机闪退换设备。 -->

#### 点击过快导致游戏卡死

高级设置中`点击后等待`设为33~333之间的数

## 日常功能

### 轮次作战

#### 什么是轮次作战

从第一关执行到最后一关后重新从第一关开始执行，直至理智耗尽。

#### 怎么刷图

勾选`轮次作战`任务，修改`作战关卡`设置，启动。

#### 作战关卡怎么设置

关卡间用空格隔开，关卡后用`*或x加数字`表示重复，中文可替换为首字母简拼，大小写随意。

建议按剿灭+活动+常规的顺序填，例如
```txt
当期委托*1 活动9*99 CA-5 PR-D-2x0 10-17 上一次x0
```
表示1次最新剿灭+99次活动9+1次CA-5+1次10-17。

`jm hd ce ls`是一个牺牲导航试错时间的通用设置。

::: tip 简写对应表
```txt
jm => dqwt*99 cqwt1*99 cqwt2*99 cqwt3*99
hd => hd-10*99 hd-9*99 ... 蓝材料及以上关卡
hd1 => hd-10 hd-9 ... hd-1 break 普通活动关各1次并退出
ce => ce-6*99 ce-5*99 ...
ls/ap/sk/ca 同 ce
pr => pr-b-2*99 pr-a-2*99 pr-c-2*99 pr-d-2*99 pr-b-1*99 pr-a-1*99 pr-c-1*99 pr-d-1*99
```
简写后不可再接次数。jm应与最大剿灭次数联用。
:::


#### 什么关卡会被跳过

- 合成玉已满时的剿灭关卡
- 未开放的资源关卡
- 未开放的活动关卡
- 不能代理的关卡
- 连续2次导航或代理失败的关卡(代理失败时通知QQ)

#### 怎么只刷n次图

作战设置中用`break`表示退出`轮次作战`任务，比如
```txt
1-7*5 CE-6 break 当期委托x5 活动6
```
表示只刷5次1-7和1次CE-6。

#### 怎么只刷1-7

勾选`轮次作战`，作战设置填`1-7`，启动

#### 怎么只刷上一次

勾选`轮次作战`，作战设置填`上一次`，启动

#### 怎么只刷活动

<!-- ::: tip -->
<!-- 本次活动UI比较复杂， -->
<!-- 目前仅1280x720分辨率支持以关卡名导航（法1）， -->
<!-- 其他分辨率请用法2 -->
<!-- ::: -->

法1. 勾选`轮次作战`，作战设置里写`活动8`或`HD-8`，启动。活动结束后会跳过。

法2. 作战设置填`上一次`，然后手动刷一次活动关再启动。

<!-- 法3. 在活动关代理指挥中启动脚本，脚本将优先重复刷当前关。 -->

#### 怎么只刷切尔诺伯格/龙门市区/龙门外环

勾选`轮次作战`，作战设置里填`长期委托X`（X是数字，按每个号的情况来设，比如`长期委托2`），启动。长期委托全过的，可直接用关卡名。

#### 什么是当期委托和长期委托

最新剿灭和老剿灭

#### 什么是DQWT、CQWT1、LMSQ、HD、SYC

当期委托、长期委托1、龙门市区、活动、上一次的首字母简拼。不能输入中文时可用。

<!-- #### 剿灭合成玉满了会跳过吗 -->
<!---->
<!-- 会 -->
<!---->
<!-- #### 资源关未开放时会跳过吗 -->
<!---->
<!-- 会 -->
<!---->
<!-- #### 没代理的关卡会跳过吗 -->
<!---->
<!-- 会 -->
<!---->
<!-- #### 作战出现非三星代理/代理失误时会跳过吗 -->
<!---->
<!-- 出现时通知QQ，连续出现三次后跳过当前关。 -->

#### 自动吃到期理智药/设置不吃药但还是吃了

默认自动吃快过期理智药（无论次数设置为多少），可在高级设置中调整。

#### 作战有没有状态或记忆

没有，脚本每次运行完全独立。每次启动从第一关开始执行。

#### 作战理智不足后能不能刷1-7清空理智

高级设置中开。

开了之后可以尽快做完日常任务。

### 基建换班

#### 基建反复进入退出/一直在主界面与基建间切换

基建退出提示要开。

#### 什么是高产换班

高产换班根据 当前实际可用基建技能 穷举所有干员组合，计算每个组合8小时平均加成，选择最高加成组合，有以下限制：  
1. 只考虑制造站贸易站收益。只考虑当前站最优，并非同类站总和最优。
1. 忽略其他站技能效果（迷迭香、焰尾、森蚺），忽略“意识协议”技能（水月）效果。
1. 部分技能效果采用近似估计，且假定每次换班间隔8小时。
1. 检查各站效率加成，动手换下看看会不会更高，有问题最好录屏反馈。

一些正确的效率比较（数字表示精英化等级）：

1. 德拉空2 > 德拉能2（4个5级宿舍），德拉孑0 > 德拉能2 > 德拉孑12（3级贸易）
1. 能+空弦2+古米、月见夜、空爆、空2 > 能德拉（4个5级宿舍）
1. 巫恋+龙舌兰+柏喙1/卡夫卡1 = 巫恋+龙舌兰+任意白板
1. 泡泡+火神+断罪1/熊猫2/砾1 > 泡泡+火神+贝娜

#### 需要精英化特定干员或使用特定基建布局吗

没必要，脚本根据实际的 设施数量、设施等级、产物类型、干员技能 来计算，不套用固定组合。

#### 什么是心情阈值

高产换班时使用，高于阈值可上班。范围[1,23]。建议用默认值12，8小时一换可实现16/8轮班制。

#### 控制中枢选人逻辑

先选+2%制造与+7%贸易干员，且防止同类技能干员一起上，剩下按鹰序。

#### 会客厅选人逻辑

先选+35%、+25%干员，剩下按鹰序。

[会客室线索搜集速度加成详解](https://www.bilibili.com/video/BV1ES4y1g7iw)

<!-- #### 办公室选人逻辑 -->
<!---->
<!-- 按联络速度加成选，忽略彩6体系与迷迭香体系效果。 -->

#### 无人机加速第n个制造站

只能加速第一个。建议手动交换制造站产品。

#### 无人机加速贸易站

不行。注意加速贸易站收益低，缺钱可打CE-6。

#### 搓玉自动补货

会

#### 芯片结束换赤金

会

#### 基建进入后卡住/不缩放

[设备兼容/手机真机](#手机真机)

### 公开招募

#### 公开招募怎么用

勾选`公开招募`任务，启动。

`自动招募`设置中`其他`表示无保底，`车456`表示保底小车与456星，勾选表示允许自动招募。

默认只勾`4`，则遇到保底56星小车时保留，遇到保底4星时自动招募，遇到无保底组合时刷新。

保底4星与小车同时出现时保底4星优先级高。如果认为小车比黄票重要，可以不勾`4`。

有保底组合但未允许自动招募时会通知QQ。

#### 非保底标签怎么自动招募

`自动招募`设置勾上`其他`。注意，现在完成每日任务并不需要靠三次公招。

#### 会不会错过资深标签

不会，一是标签识别非常保守，有问题就保留，二是有官方保险，在未勾选资深标签时招募或刷新都会弹窗，脚本遇到会卡住，但理论上不会遇到。

<!-- #### 为什么单选了生存/防护 -->
<!---->
<!-- 勾了`其他`后，在遇到非保底标签时会选 生存、防护 来提高出火神概率。 -->

#### 为什么没选X标签

保底组合有多个，脚本选了其一。

#### 怎么刷黄票绿票/刷加急券/刷公招

点击`肉鸽/公招`按钮

`自动招募`只勾`其他`时，刷出保底标签就停；只勾`其他`、`4`时，刷出保底小车、保底5星、6星就停；其余同理。

`保留标签`填期望标签（例如填`削弱 快速复活`），则刷到任意一个就停。

### 线索交流

#### 线索满了给谁

优先给缺线索且今日登录的好友

#### 线索小号/只送线索不解锁线索

高级设置中可设置

### 信用购买

#### 信用交易所尽量买/不买指定商品

`信用多/少买` 填商品关键字（如`碳 家 急 招 技巧`）

### 限时活动

#### 什么是限时活动

限时签到、限时抽签、赠送寻访


### 多号管理

#### 启用账号怎么填

`启用账号`填`1-30`表示跑前30个号，填`7 10-8 7 1-3`等价于`7 10 9 8 7 1 2 3`。

仅生效一次的账号写在#号后，填`1-30 # 13 14`表示本次启动跑第13、14两个，后续启动跑前30个。

账密任一为空则跳过，可在高级设置中调整。

#### 怎么对每个账号单独设置

点击`单号设置/继承设置`按钮直到其显示为`独立设置`

#### 怎么设置每个账号的登录时间

目前仅支持控制周末是否登录

### 集成战略

#### 怎么刷肉鸽投资、源石锭、等级蜡烛、藏品、剧目

点击`肉鸽/公招`按钮

选择常见近卫，如(数字表示技能)耀光1、煌2、山2、帕拉斯1、赫拉格2、史尔特尔2、银灰1、羽毛笔1、幽灵鲨1、拉狗2。

刷等级蜡烛应选`正式难度`，勾`多点蜡烛`、`跳过投币`，从0到110正常需36小时，最快26小时。

刷源石锭应选`观光难度`，从0到999的耗时与结局通关数量相关。双结局耗时10时14分(97个/时)，三结局耗时8时10分(122个/时)，低网络延迟+三结局耗时[7时21分](https://www.bilibili.com/video/BV11T4y1S7cj)(135个/时)

建议勾选每8小时做日常，并设置好关卡。建议配合QQ通知使用，会有每小时进度提醒与完成等级/源石锭/商品需求后的通知。

刷商品可在需求商品上填写名称关键字，如填`玩 金 骑士`，则刷到任一加功速藏品就停止。

掉线抢登处理与单号相同。支持凌晨4点更新。

<!-- #### 卡在`请选择难度` -->
<!---->
<!-- 第一次需要手动选择难度。 -->

#### 为什么游戏闪退/重启

游戏本体存在内存泄漏，因此会抽空重启。可在高级设置中调整，但不建议。

#### 不能选助战干员

是。选任一精一满级的5、6星近卫刷。可以和其他助战脚本对比下效率。

## 托管功能

### 定时启动

#### 什么是定时启动

任务完成后，如果设了定时，脚本会等到下个定时点重启。只是打开脚本，但没按`仅定时`或`启动并定时`无效。注意系统时区是不是东八区。

#### 定时到点了会停止当前的任务吗

不会，定时点会被跳过。

#### 定时可以设几个

任意

#### 定时任务与刷源石锭冲突吗

刷源石锭是永不完成的任务，不受定时影响。

#### 定时任务无间隙/无限循环/无等待

定时任务写`+0:00`。但脚本预设场景是一天3次。

### QQ通知

#### QQ通知有什么用

任务完成后，机器人将把首页截图发给QQ。

一般与 定时任务+云手机/模拟器/备用机 配合使用，这样平时只需检查聊天记录，无需接触游戏。

代理失败、登录失败、异常状态、可招募组合、肉鸽进度也会通知。

#### QQ通知怎么用

<!-- > 先加反馈群，水月头像管理员是机器人。 -->
<!-- > -->
<!-- > 创建群聊将数个机器人拉进群，将群号填到脚本主界面上`完成后通知QQ`后。 -->
<!-- > -->

将个人QQ号(需要是机器人好友)或群号(需要是机器人所在群)填到脚本高级设置`QQ通知账号`即可。

目前公开机器人由于风控严重已不再提供，请按下面的教程自建。风控主要和好友数群数以及消息内容消息数量相关，少部分人使用不会风控。

也可以设置pushplus账号，但只有文字。其他推送方案如 QQ频道、telegram机器人、wecomchan、喵提醒、邮件，没有集成计划，如果需要可以pull request，参考notifyqq与notifypp函数。

高级设置中可设置更多情况的通知。

#### QQ通知服务怎么自建

<!-- 想提高QQ通知的稳定性与安全性可自建服务。 -->

在一个脚本能连接的设备上（模拟器脚本能连接宿主机、安卓脚本能连接同设备termux、安卓脚本能连接有公网IP的服务器），用npm安装[qqimagedeliver](https://github.com/tkkcc/qqimagedeliver)
```sh
npm i -g qqimagedeliver
```

用闲置QQ号登录
```sh
qqimagedeliver --username=12345 # 先扫码登录
qqimagedeliver --username=12345 --password=abcde --maxtry=2 # 再密码登录
```
服务器防火墙要开放服务端口(默认49875)

将`服务器IP地址或域名:服务端口`填到脚本高级设置`QQ通知自建服务地址`
```txt
82.156.198.12:49875
```
用自己QQ加该QQ为好友，将自己QQ填到脚本高级设置`QQ通知账号`

脚本主界面任务全不勾，启动，观察能否收到QQ通知

> 同人教程 可能会有错误内容，请勿以在群内反馈问题  
> [明日方舟速通: Windows搭建本地通知教程](https://shimo.im/docs/KrkEVQYpXdi4XEAJ)  

#### QQ通知的设备名怎么设置

`QQ通知账号`中加`#设备名`，如`1009619697#雷电云5`

#### QQ通知的账号备注怎么设置

账号后加`#备注`，如`13888888888#点点1`，可换行。

::: tip
账号与密码中的空格、回车都会被过滤，一行填不下请换行
:::

#### QQ通知怎么过滤重要提醒

填两个QQ号，如`1009619697 1009619698 #雷5`。stop信息 与 代理失败信息 会一并发送给第二个QQ。

### 异常处理

#### 单号密码错误会怎么处理

等待1小时后重试，可配合QQ通知使用。

#### 多号密码错误会怎么处理

暂时跳过该账号，可配合QQ通知使用。

#### 账号被抢登/抢占或掉线会怎么样  

默认单号10分钟最大登录次数不能超过3次，遇到就会跳过(多号)或等1小时(单号/肉鸽)，可在高级设置中调整。

一种情况是先正常切号登录（第一次），然后被抢登或掉线回到登录界面（第二次），依次类推。

另一种情况是先被抢登回到登录界面，脚本抢回（第一次），然后又被抢登或掉线回到登录界面（第二次），依次类推。

网络不稳定（校园网/部分云手机）可能频繁掉线，需要调大。

#### 登陆出现滑动验证码

一段时间内多次登陆时出现，会自动解。



## 安全性

#### 为什么申请短信拨号权限

框架限制。框架为脚本提供发短信拨号功能，因此会申请所需权限，即使脚本不使用这些功能。不放心可在虚拟机、模拟器、云手机上使用。

#### 为什么申请root权限

有root权限时脚本能自动开无障碍、关闭游戏、亮屏熄屏、录入锁屏手势密码、进程保活。

#### 系统检测为病毒/风险

框架限制。无法安装或不放心可在虚拟机、模拟器、云手机上使用。

#### 实现原理是什么

脚本通过无障碍录屏方式获取屏幕，判断状态，执行相应的操作，即所谓的图色脚本。不碰内存与网络。

#### 是否会上传泄漏账号密码

如果设置了通知QQ，则在发送通知时会上传`账号`与`游戏截屏`至开发者部署的转发服务。

转发服务就是QQ机器人，与腾讯服务器通信。

转发服务开源，可以[自建](#qq通知服务怎么自建)，部署到自己的设备上。

任何情况下不会上传`密码`。

## 命令行控制


#### 多设备多账号管理

以下命令中`0 m ...`等价于`./0.sh mode ...`，也等价于`./dlt.py mode ...`

仅支持可adb连接的设备。

```sh
### 设备管理
# 用scrcpy远程控制串号为103.36.203.132:302的设备
0 m 103.36.203.132:302 show
# 用别名9（别名在函数开头设置）
0 m 9 show
# adb命令
0 m 9 adb shell pwd
# 内存/进程监测
0 m 9 free
0 m 9 top
0 m 9 ps
# 查看最近通知，下载查看最新通知图片
0 m 9 pic
0 m 9 pic 1234
# 华云root设置
0 m 9 hy

### 日常模式
# 应用通用设置
0 m 9 normal
# 设置通知QQ，周末不打账号
0 m 9 normal --name=\'1111,2222#9\' --weekday-only='31 32'
# 查看所有账号
0 m 9 user
# 添加官服账号，无特殊要求
0 m 9 user 12345 67890
# 添加官服账号，优先近卫特种芯片
0 m 9 user 12345 67890 --fight='jm pr-d-2*99 pr-d-1*99 ce ls'
# 添加B服账号，优先红票，且周末不打
0 m 9 user 12345 67890 b --fight='jm ap ls' --weekday-only
# 修改第10个账号
0 m 9 user 12345 67890 --idx=10
# 删除第10个账号
0 m 9 user 12345 '' --idx=10
# 开打
0 m 9 restart
# 开打，本次只打第10个
0 m 9 restart 10

### 肉鸽模式
# 设置官服账号，切号
0 m 9 rg1 12345 67890
# 设置B服账号，体力打芯片，切号
0 m 9 rg1 12345 67890 b --fight='pr ls'
# 不做日常，导航到近卫干员选择界面停止
0 m 9 rg2
# 设置干员技能，设置等级125，开打
0 m 9 rg2 1 0 1 125
# 开打
0 m 9 restart --rg
```

#### 平台相关

```sh
# 听单
0 dlt
# 接单
0 o 11111 2222
# 详情
0 d 11111
# 上传
0 submit 11111
# 结束
0 over 11111
# 关键字转单号
0 s 阳光
0 s 13888888888
# 列表
0 my
0 my --rg
```

## 云端控制

开发中

明日方舟速通云控后端: [DazeCake/ArkLightsCloudBackEnd](https://github.com/DazeCake/ArkLightsCloudBackEnd)
